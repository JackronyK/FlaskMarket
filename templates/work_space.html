{% extends 'admin_base.html' %}
{% block title %}Admin Home | Flask Market{% endblock %}

{% block content %}
  {% if not session.get('admin_logged_in') %}
    <div class="text-center mt-5">
      <h3 class="text-danger"><i class="fas fa-lock me-2"></i>You must be logged in to access the admin dashboard</h3>
      <a href="{{ url_for('admin_login') }}" class="btn btn-primary mt-4 px-4">Login Now</a>
    </div>
  {% else %}
  <div class="container-fluid py-4">

    <!-- WELCOME -->
    <div class="row mb-4">
      <div class="col text-center">
        <h2 class="mb-2">Karibu Admin ðŸŽ©</h2>
        <p class="lead text-muted">
          Manage inventory{% if session.get('is_super_admin') %}, approve admins{% endif %}, and keep the market running smoothly.
        </p>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="card cardhover shadow-sm h-100">
          <div class="card-body text-center">
            <i class="fas fa-plus-circle fa-3x text-success mb-3"></i>
            <h5>Upload New Item</h5>
            <a href="{{ url_for('admin_item_upload') }}" class="btn btn-outline-success rounded-pill px-4 mt-2">
              <i class="fas fa-upload"></i> Upload
            </a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card cardhover shadow-sm h-100">
          <div class="card-body text-center">
            <i class="fas fa-boxes fa-3x text-primary mb-3"></i>
            <h5>View Inventory</h5>
            <a href="{{ url_for('admin_items_view') }}" class="btn btn-primary rounded-pill px-4 mt-2">
              <i class="fas fa-eye"></i> View Items
            </a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card cardhover shadow-sm h-100">
          <div class="card-body text-center">
            <i class="fas fa-tools fa-3x text-warning mb-3"></i>
            <h5>Manage Inventory</h5>
            <a href="{{ url_for('admin_items_manage') }}" class="btn btn-warning rounded-pill px-4 mt-2">
              <i class="fas fa-cogs"></i> Manage
            </a>
          </div>
        </div>
      </div>
    </div>

    {% if session.get('is_super_admin') %}
      <!-- SUPER ADMIN ACTIONS -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card cardhover shadow-sm h-100">
            <div class="card-body text-center">
              <i class="fas fa-user-check fa-3x text-danger mb-3"></i>
              <h5>Approve Admins</h5>
              <a href="{{ url_for('super_admin_approvals') }}" class="btn btn-warning rounded-pill px-4 mt-2">
                <i class="fas fa-check-circle"></i> Approve
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card cardhover shadow-sm h-100">
            <div class="card-body text-center">
              <i class="fas fa-users-cog fa-3x text-secondary mb-3"></i>
              <h5>Manage Admins</h5>
              <a href="{{ url_for('super_admin_manage') }}" class="btn btn-secondary rounded-pill px-4 mt-2">
                <i class="fas fa-user-shield"></i> Manage Admins
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <!-- STATS & RECENT ACTIVITY -->
    <div class="row g-4">
      <!-- ITEM STATS FOR ALL ADMINS -->
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0">
            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i> Market Statistics</h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-4">
                <h3 class="text-primary">{{ stats.total_items or 'â€”' }}</h3>
                <small class="text-muted">Total Items</small>
              </div>
              <div class="col-4">
                <h3 class="text-success">{{ stats.updated_items or 'â€”' }}</h3>
                <small class="text-muted">Updated Items</small>
              </div>
              <div class="col-4">
                <h3 class="text-danger">{{ stats.deleted_items or 'â€”' }}</h3>
                <small class="text-muted">Deleted Items</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RECENT ITEM ACTIVITY -->
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0">
            <h5><i class="fas fa-history me-2"></i> Recent Item Activity</h5>
          </div>
          <div class="card-body">
            {% if recent_items_logs %}
              <ul class="list-group list-group-flush">
              {% for log in recent_items_logs %}
                <li class="list-group-item border-0 px-0">
                  <small class="text-muted">{{ log.timestamp.strftime('%b %d %I:%M %p') }}</small>
                  <p class="mb-0">{{ log.notes }}</p>
                </li>
              {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted text-center mb-0">No recent activity</p>
            {% endif %}
          </div>
          <div class="text-end mt-2">
            <a href="{{ url_for('item_activity_log') }}" class="btn btn-info btn-sm">
              Full Item Log <i class="fas fa-arrow-right ms-1"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    {% if session.get('is_super_admin') %}
      <!-- ADMIN STATS & ACTIVITY (SUPER ADMINS ONLY) -->
      <div class="row g-4 mt-4">
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-0">
              <h5><i class="fas fa-chart-pie me-2"></i> Admin Statistics</h5>
            </div>
            <div class="card-body text-center">
              <div class="row">
                <div class="col-4">
                  <h3 class="text-primary">{{ stats.total_admins or 'â€”' }}</h3>
                  <small class="text-muted">Total Admins</small>
                </div>
                <div class="col-4">
                  <h3 class="text-success">{{ stats.active_admins or 'â€”' }}</h3>
                  <small class="text-muted">Active Admins</small>
                </div>
                <div class="col-4">
                  <h3 class="text-warning">{{ stats.pending_approvals or 'â€”' }}</h3>
                  <small class="text-muted">Pending Approvals</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-0">
              <h5><i class="fas fa-history me-2"></i> Recent Admin Activity</h5>
            </div>
            <div class="card-body">
              {% if recent_admins_logs %}
                <ul class="list-group list-group-flush">
                {% for log in recent_admins_logs %}
                  <li class="list-group-item border-0 px-0">
                    <small class="text-muted">{{ log.timestamp.strftime('%b %d %I:%M %p') }}</small>
                    <p class="mb-0">{{ log.notes }}</p>
                  </li>
                {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted text-center mb-0">No recent activity</p>
              {% endif %}
            </div>
            <div class="text-end mt-2">
              <a href="{{ url_for('admin_activity') }}" class="btn btn-info btn-sm">
                Full Admin Log <i class="fas fa-arrow-right ms-1"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

  </div>
  {% endif %}
{% endblock %}
